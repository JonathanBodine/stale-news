# tester.py
# -------
# Tests for regression.py
import regression as r
import databases as d
import time

# setup databases to read in from
compustat = d.PandasDatabase("compustatQ.csv")
crsp = d.CRSPDatabase("crspdaystock.csv")
crspmini = d.CRSPDatabase("crspdaystockmini.csv")
db = d.MeasuresDatabase("simulated_data.txt")
print("SETUP DONE")
"""
Find shared firms between databases
compustat.recordTickers("tic", False)
crsp.recordTickers("TICKER", False)
sharedTics = set(compustat.tics) & set(crsp.tics) & set(db.tics.keys())
sharedTics = list(sharedTics)
"""
"""
Find shared dates between crsp and measures databases
crsp.recordDates("date", False)
unsynced = []
sharedDates = (set(map(str, crsp.dates)) & set(db.dates.keys())) - set(unsynced)
sharedDates = list(sharedDates)
sharedDates.sort()
print(sharedDates)
"""

sharedTics = ['WBA', 'WETF', 'LL', 'ADVS', 'CME', 'CI', 'UPS', 'FIS', 'TRN', 'FDX', 'WMT', 'BA', 'MTB', 'EXC', 'RTN',
              'OI', 'SRCL', 'CELG', 'CG', 'MGM', 'DE', 'UAL', 'PRU', 'MON', 'VIAB', 'HLT', 'ABT', 'FOXA', 'FCX', 'GFIG',
              'VZ', 'GNW', 'HAL', 'RAI', 'CAG', 'M', 'SBUX', 'DAL', 'DLR', 'NFLX', 'DHR', 'AMGN', 'SF', 'AVGO', 'PFE',
              'PM', 'CCI', 'PG', 'MS', 'YUM', 'KHC', 'LLY', 'NKE', 'NXPI', 'AER', 'V', 'TXN', 'MU', 'SYY', 'WLL', 'XOM',
              'CBS', 'JNJ', 'CTXS', 'PRGO', 'TRCO', 'IEP', 'COST', 'BIIB', 'PETC', 'AAPL', 'MO', 'QRVO', 'TGNA', 'MMM',
              'HUM', 'MYL', 'BHI', 'AMAT', 'WFM', 'BGCP', 'DIS', 'ATI', 'VRSK', 'UTX', 'TMUS', 'PLL', 'PCG', 'MSFT',
              'MET', 'PXD', 'AVP', 'F', 'MMS', 'CAT', 'HES', 'ENDP', 'INTC', 'GS', 'BX', 'BGC', 'HCBK', 'SLXP', 'NDAQ',
              'PYPL', 'APA', 'KR', 'OLN', 'PEP', 'MCD', 'CHTR', 'SPG', 'GCI', 'CNC', 'HRC', 'HPQ', 'LOW', 'UNH', 'LC',
              'PSX', 'AGN', 'WPX', 'NYT', 'MCK', 'DLTR', 'HON', 'FB', 'YELP', 'OVTI', 'ZTS', 'OMF', 'GEVA', 'T', 'ALT',
              'SNAP', 'EMC', 'ADP', 'COP', 'STE', 'ANTM', 'DOW', 'LNKD', 'JCI', 'QCOM', 'ARRS', 'GOOGL', 'OCN', 'MPC',
              'BBY', 'GE', 'NE', 'ARES', 'GGP', 'ALTR', 'AA', 'AIG', 'JPM', 'AAL', 'ALL', 'BMY', 'ORCL', 'VIRT', 'KKR',
              'AXP', 'CMCSA', 'LUV', 'MA', 'AMZN', 'OB', 'ARCC', 'WU', 'OXY', 'LAUR', 'EBAY', 'SPB', 'CSCO', 'GLPI',
              'KO', 'DD', 'SWKS', 'JACK', 'BLDR', 'LO', 'MRK', 'SPRD', 'CVX', 'MSI', 'FIT', 'EIGI', 'DISH', 'ARNC',
              'THOR', 'OCR', 'HMSY', 'BLK', 'ABBV', 'ESRX', 'NSM', 'UDR', 'BAC', 'SYMC', 'S', 'COTY', 'OPK', 'XPO',
              'ALXN', 'WTM', 'CRM', 'STJ', 'MGI', 'BBT', 'NFBK', 'MAC', 'AET', 'HIG', 'C', 'HD', 'FCAU', 'EPD', 'ALLY',
              'TSLA', 'LIVN', 'TGT', 'AAP', 'ICE', 'CAH', 'TWTR', 'BABA', 'APO', 'IBM', 'CVS', 'JBLU', 'GM', 'GILD',
              'ZNGA', 'WFC']
allSharedDates = ['20150521', '20150522', '20150526', '20150527', '20150528', '20150529', '20150601', '20150602',
               '20150603', '20150604', '20150605', '20150608', '20150609', '20150610', '20150611', '20150615',
               '20150616', '20150617', '20150618', '20150619', '20150622', '20150623', '20150624', '20150625',
               '20150629', '20150630', '20150701', '20150702', '20150706', '20150707', '20150708', '20150709',
               '20150713', '20150714', '20150715', '20150716', '20150717', '20150720', '20150721', '20150722',
               '20150723', '20150724', '20150727', '20150728', '20150729', '20150730', '20150731']
sharedDates = ['20150521', '20150522']

"""
Test: famaMacBethRegression8_9 equation 8 functionality
[20150521 - 20150730] Full Sample
[20150521] 1 Day
({'a': -0.0034101166708870034, 'b': -0.01843736557065106, 'g1': -0.010654682293966895, 'g2': -0.006701822965388907, 
'g3': 6.896700570472351e-05, 'g4': -0.007594418789522064, 'g5': -0.01721832101183742, 'g6': -0.004480788308241562, 
'g7': -0.003865690346330424, 'g8': -0.0018159950060968393, 'g9': -0.03183571394146708}, 
{'ase': 1.950058950595755e-15, 'bse': 1.4266642786125925e-15, 'g1se': 6.760902824318515e-16, 
'g2se': 5.771224738172824e-16, 'g3se': 1.1299004677633281e-18, 'g4se': 2.912660555082555e-16, 
'g5se': 6.061201704575776e-16, 'g6se': 3.402100480155517e-16, 'g7se': 3.0082503326011166e-16, 
'g8se': 2.1091422792070395e-16, 'g9se': 1.0608107096786021e-15})
[20150521 , 20150522] 2 Days
({'a': -0.0015170749692255598, 'b': -0.009218682785325564, 'g1': -0.005139357780765608, 'g2': -0.0032360662812467985, 
'g3': -0.00011939407962051235, 'g4': 4.695248810642665e-05, 'g5': -0.008967903417169784, 'g6': -0.002182351562233112, 
'g7': -0.0019228436449183588, 'g8': -0.0009017795034672995, 'g9': -0.01428856754974274}, 
{'ase': 9.750294845935269e-16, 'bse': 7.133321393062962e-16, 'g1se': 3.380451680275281e-16,
'g2se': 2.8856124864335086e-16, 'g3se': 5.825395349848871e-19, 'g4se': 1.4565904647430257e-16, 
'g5se': 3.030601942675734e-16, 'g6se': 1.7010502909298193e-16, 'g7se': 1.504125168007829e-16, 
'g8se': 1.0545711405444639e-16, 'g9se': 5.304066408166379e-16})
"""
start = time.time()
print(r.famaMacBethRegression8_9(sharedDates, sharedTics, db, crsp, compustat))
end = time.time()
print(end - start)


"""
Test: famaMacBethRegression8_9 equation 9 functionality
[20150521, 20150522] 2 Days
({'a': 0.2631741936040208, 'b': -0.0741170204254642, 'g1': 0.07144063805560394, 'g2': -0.0368883693166605, 
'g3': -0.0011634315331780967, 'g4': 0.027543089519158494, 'g5': 0.04679843096704336, 'g6': -0.01134560706957816, 
'g7': 0.05196830627571125, 'g8': 0.03395344559268402, 'g9': 0.07813254525484842}, 
{'ase': 2.941836885342004e-14, 'bse': 2.6352591660860492e-14, 'g1se': 2.406209152200528e-14, 
'g2se': 9.703911017001808e-15, 'g3se': 2.3771525992662903e-17, 'g4se': 8.035748907765897e-15, 
'g5se': 1.7662471500861705e-14, 'g6se': 7.46498624419643e-15, 'g7se': 6.1601347035236e-15, '
g8se': 3.708914574117555e-15, 'g9se': 3.341271050007141e-14})
start = time.time()
print(r.famaMacBethRegression8_9(sharedDates, sharedTics, db, crsp, compustat, False))
end = time.time()
print(end - start)
"""

"""
Test: famaMacBethRegression10_11 equation 10 functionality
[20150521, 20150522] 2 Days
({'a': -0.004286281556348699, 'b1': -0.006154108145366264, 'b2': -0.007589847697309861, 'g1': -0.0035978502833208864, 
'g2': -0.002047751070561573, 'g3': -0.00012036425861499941, 'g4': 0.0006710034497910077, 'g5': -0.00764750939709012, 
'g6': -0.001408416708821062, 'g7': -0.0021258216294194254, 'g8': -0.0011059548386933894, 'g9': -0.012047390441743626}, 
{'ase': 3.63110070841677e-16, 'b1se': 3.475961489430331e-16, 'b2se': 4.286895466137083e-16, 
'g1se': 2.493859396280256e-16, 'g2se': 1.3242997855594122e-16, 'g3se': 5.492499463717016e-19, 
'g4se': 6.702644859746234e-17, 'g5se': 1.5988188669741583e-16, 'g6se': 9.344406243988276e-17, 
'g7se': 4.9735339089010635e-17, 'g8se': 3.541226969770182e-17, 'g9se': 2.6139401994815094e-16})
start = time.time()
print(r.famaMacBethRegression10_11(sharedDates, sharedTics, db, crsp, compustat))
end = time.time()
print(end - start)
"""

"""
Test: famaMacBethRegression10_11 equation 11 functionality
[20150521, 20150522] 2 Days
({'a': 0.24091012985868826, 'b1': -0.049478235636472835, 'b2': -0.06102139643014934, 'g1': 0.08383415948755854, 
'g2': -0.027334468310043384, 'g3': -0.0011712316471451155, 'g4': 0.03256037875133564, 'g5': 0.05741422856359787, 
'g6': -0.00512327068224316, 'g7': 0.050336389463552234, 'g8': 0.032311902235153706, 'g9': 0.09615132010139277}, 
{'ase': 2.0936680733981898e-14, 'b1se': 2.3107862854726312e-14, 'b2se': 2.849887514728376e-14, 
'g1se': 1.6855679191246836e-14, 'g2se': 8.752495499777612e-15, 'g3se': 3.898377299388014e-17, 
'g4se': 4.3449775859060354e-15, 'g5se': 9.926008368925261e-15, 'g6se': 6.256828607604531e-15, 
'g7se': 1.9121869152745727e-15, 'g8se': 1.6395451916128076e-15, 'g9se': 1.6107797511116788e-14})
start = time.time()
print(r.famaMacBethRegression10_11(sharedDates, sharedTics, db, crsp, compustat, False))
end = time.time()
print(end - start)
"""

"""
Test: famaMacBethRegression10_11 equation 11 functionality
[20150521, 20150522] 2 Days t1:2 t2:4
({'a': 0.02236262115179763, 'b1': 0.001496028799729174, 'b2': -9.782403482172575e-06, 
'b3': -0.0013073914181709852, 's1': 0.0018450489449528492, 's2': -1.2064616154304592e-05, 
'g1': -0.0027271642563329933, 'g2': 0.0002764011967493809, 'g3': 2.9351660731023416e-05, 
'g4': 0.0052788135068051, 'g5': 0.012169616575148163, 'g6': -0.0003098664340539698, 
'g7': 0.006048376034563645, 'g8': 0.0035335087387437006, 'g9': 0.02555753019511148}, 
{'ase': 1.828729300530175e-15, 'b1se': 9.973118245351898e-16, 'b2se': 1.1486381363198629e-17, 
'b3se': 2.6183401006626247e-16, 's1se': 1.229982424122309e-15, 's2se': 1.416612823181251e-17, 
'g1se': 7.68916127621975e-16, 'g2se': 4.221364315499428e-16, 'g3se': 1.6251504481742898e-18, 
'g4se': 1.334324462994145e-16, 'g5se': 3.24747875605229e-16, 'g6se': 2.351186401341406e-16, 
'g7se': 3.0777695588360946e-16, 'g8se': 2.1220535582557158e-16, 'g9se': 4.183087324650582e-16})
[20150521, 20150522] 2 Days t1:2 t2:6
({'a': 0.027031827832452192, 'b1': -0.012045136570886551, 'b2': 0.0001485305381011918, 
'b3': -0.0039048395639444027, 's1': -0.014855239769415178, 's2': 0.00018318237768266235, 
'g1': -0.008697501467783055, 'g2': -0.00490814890816973, 'g3': 7.034783160549806e-05, 
'g4': -0.00034731615606390623, 'g5': 0.002830066828202213, 'g6': -0.0035498342156802766, 
'g7': 0.005002203942478822, 'g8': 0.0032854916013070595, 'g9': 0.007485482678628687}, 
{'ase': 2.1743843950674256e-15, 'b1se': 1.1044955430175962e-15, 'b2se': 1.2562260378284748e-17, 
'b3se': 2.9690277504440734e-16, 's1se': 1.3621718624124495e-15, 's2se': 1.5493007394851967e-17, 
'g1se': 8.201151407083401e-16, 'g2se': 4.781409052153265e-16, 'g3se': 1.6099904419378443e-18, 
'g4se': 1.3094121653966782e-16, 'g5se': 2.9143709348766676e-16, 'g6se': 2.4986699892486946e-16, 
'g7se': 3.6785587483153637e-16, 'g8se': 2.536872525500835e-16, 'g9se': 3.237096462579345e-16})
[20150521, 20150522] 2 Days t1:2 t2:11
({'a': 0.10522513004393624, 'b1': -0.0528453062403024, 'b2': 0.0006087613871164834, 
'b3': -0.014980711392309267, 's1': -0.06517399701264531, 's2': 0.0007507840458869627, 
'g1': -0.005731731901229308, 'g2': -0.022676635805112807, 'g3': 8.469653484315611e-05, 
'g4': -0.006052729946094202, 'g5': 0.002454011791038771, 'g6': -0.01231450287606868, 
'g7': 0.017655492729398054, 'g8': 0.012145994602558295, 'g9': 0.0027627337998703348}, 
{'ase': 8.68501212471345e-15, 'b1se': 4.294600784704544e-15, 'b2se': 4.8524204797917685e-17, 
'b3se': 1.1614424903296073e-15, 's1se': 5.296521462854081e-15, 's2se': 5.984479234827014e-17, 
'g1se': 3.1199861678925872e-15, 'g2se': 1.8772277017062383e-15, 'g3se': 6.061817923500417e-18, 
'g4se': 5.048519906669864e-16, 'g5se': 1.0791621502658731e-15, 'g6se': 9.486831175741856e-16, 
'g7se': 1.4764738908104658e-15, 'g8se': 1.0170979502846877e-15, 'g9se': 1.164950913339086e-15})
t1 = 2
t2 = 11
start = time.time()
print(r.famaMacBethRegression12(sharedDates, sharedTics, db, crsp, compustat, t1, t2))
end = time.time()
print(end - start)
"""





